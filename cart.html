<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gi·ªè h√†ng | L·ªòC HO√ÄI</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="script.js"></script>
</head>
<body>

  <header>
    <button onclick="history.back()" style="margin: 10px;">‚¨Ö Tr·ªü v·ªÅ</button>
    <h2 style="text-align:center">Gi·ªè h√†ng c·ªßa b·∫°n</h2>
  </header>

  <main>
    <div id="cart-items" class="product-grid"></div>

    <div style="padding: 20px;">
      <h3>T·ªïng c·ªông: <span id="total-amount">0</span>‚Ç´</h3>
      <p>Ph√≠ v·∫≠n chuy·ªÉn: <span id="shipping-fee">20,000</span>‚Ç´ (Mi·ªÖn ph√≠ cho ƒë∆°n > 200,000‚Ç´)</p>
      <div style="margin-top: 10px;">
        <button onclick="history.back()">‚¨Ö Tr·ªü v·ªÅ</button>
        <button onclick="showOrderForm()" style="float:right; background: #28a745; color:white; padding:10px;">ƒê·∫∂T H√ÄNG</button>
      </div>
    </div>
  </main>

  <div id="order-form" style="display:none; position:fixed; top:20%; left:15%; width:70%; background:#fff; border:1px solid #ccc; padding:20px; z-index:999;">
    <h3>Th√¥ng tin ƒë·∫∑t h√†ng</h3>
    <input id="name" placeholder="H·ªç t√™n" style="width:100%;margin:5px 0;padding:10px;" />
    <input id="phone" placeholder="SƒêT" style="width:100%;margin:5px 0;padding:10px;" />
    <input id="address" placeholder="ƒê·ªãa ch·ªâ" style="width:100%;margin:5px 0;padding:10px;" />
    <div style="margin-top:10px;">
      <button onclick="hideOrderForm()">‚ùå H·ªßy</button>
      <button onclick="submitOrder()" style="float:right; background: #dc3545; color:white; padding:10px;">ƒê·∫∑t h√†ng</button>
    </div>
  </div>

  <script>
    function renderCart() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const container = document.getElementById('cart-items');
      const totalEl = document.getElementById('total-amount');
      let total = 0;
      container.innerHTML = '';

      cart.forEach(item => {
        const div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `
          <h4>${item.name}</h4>
          <p>SL: ${item.qty} x ${item.price.toLocaleString()}‚Ç´</p>
          <p><strong>T·∫°m t√≠nh: ${(item.qty * item.price).toLocaleString()}‚Ç´</strong></p>
        `;
        total += item.qty * item.price;
        container.appendChild(div);
      });

      document.getElementById('shipping-fee').textContent = total >= 200000 ? '0' : '20,000';
      totalEl.textContent = (total + (total >= 200000 ? 0 : 20000)).toLocaleString();
    }

    function showOrderForm() {
      document.getElementById('order-form').style.display = 'block';
    }

    function hideOrderForm() {
      document.getElementById('order-form').style.display = 'none';
    }

    function generateOrderCode() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const letters = Array.from({ length: 3 }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
      const numbers = Math.floor(1000000 + Math.random() * 9000000);
      return `${letters}${numbers}`;
    }

    function submitOrder() {
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const address = document.getElementById('address').value.trim();
      if (!name || !phone || !address) {
        alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin');
        return;
      }

      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const orderCode = generateOrderCode();
      const now = new Date();
      const time = now.toLocaleTimeString('vi-VN');
      const date = now.toLocaleDateString('vi-VN');
      const productList = cart.map(item => `- ${item.name} x ${item.qty}`).join('\n');

      const total = cart.reduce((sum, item) => sum + item.qty * item.price, 0);
      const shipping = total >= 200000 ? 0 : 20000;
      const finalTotal = total + shipping;

      const message = `üì¶ ƒê∆†N H√ÄNG M·ªöI: ${orderCode}
üïíTh·ªùi gian: ${time} - ${date}
üë§ T√™n: ${name}
üìû SƒêT: ${phone}
üè† ƒê·ªãa ch·ªâ: ${address}

üõí S·∫£n ph·∫©m:
${productList}

üöö Ph√≠ ship: ${shipping.toLocaleString()}‚Ç´
üí∞ T·ªïng c·ªông: ${finalTotal.toLocaleString()} ƒë`;

      fetch(`https://api.telegram.org/bot7986532916:AAGPbxtqJHILVuHBYb0fwsKU62a4jEJ8Jp8/sendMessage`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          chat_id: "7774024453",
          text: message
        })
      })
      .then(res => {
        if (res.ok) {
          alert("‚úÖ ƒê·∫∑t h√†ng th√†nh c√¥ng!");
          localStorage.removeItem('cart');
          window.location.href = 'index.html';
        } else {
          alert("‚ùå G·ª≠i ƒë∆°n kh√¥ng th√†nh c√¥ng!");
        }
      });
    }

    window.onload = renderCart;
  </script>

</body>
</html>
